<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>åˆ†å­ç‚¹ç¾¤ä¸å¯¹ç§°æ“ä½œäº¤äº’æ¼”ç¤ºï¼ˆå¸¦è§†è§’ä¿æŒï¼‰</title>
<script src="jsmol/JSmol.min.js"></script>
<style>
body {
  margin: 0;
  font-family: "Inter","Segoe UI",Arial,Helvetica,sans-serif;
  background: #f3f4f6;
  color: #374151;
  overflow: hidden;
}
.header {
  background: linear-gradient(90deg,#991b1b,#b91c1c);
  color: white;
  padding: 14px 22px;
  font-size: 20px;
  font-weight: 600;
  height: 60px;
  box-sizing: border-box;
}
.main {
  display: flex;
  height: calc(100vh - 60px);
  box-sizing: border-box;
  gap: 14px;
  padding: 14px;
}
.viewer-panel {
  flex: 1;
  background: white;
  border-radius: 14px;
  padding: 12px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.08);
  display: flex;
  flex-direction: column;
  min-width: 0; /* é˜²æ­¢å†…å®¹æº¢å‡º */
}
#viewer {
  flex: 1;
  width: 100%;
  min-height: 0; /* å…è®¸flexå­é¡¹ç¼©å° */
  border-radius: 10px;
  border: 1px solid #d1d5db;
  background: white;
}
.pg-info {
  margin-top: 14px;
  padding: 14px 16px;
  border-radius: 12px;
  background: linear-gradient(180deg,#fafafa,#f3f4f6);
  border: 1px solid #e5e7eb;
  flex-shrink: 0;
}
.pg-title {
  font-weight: 600;
  font-size: 14px;
  margin-bottom: 6px;
  color: #111827;
}
.pg-text {
  font-size: 13px;
  line-height: 1.65;
  color: #4b5563;
}
.control-panel {
  width: 380px;
  background: white;
  border-radius: 14px;
  padding: 16px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.08);
  overflow-y: auto;
  flex-shrink: 0;
}
.section {
  margin-bottom: 18px;
}
.section-title {
  font-weight: 600;
  font-size: 14px;
  margin-bottom: 8px;
  border-left: 4px solid #b91c1c;
  padding-left: 8px;
}
button {
  margin: 4px;
  padding: 7px 16px;
  font-size: 14px;
  border-radius: 999px;
  border: 1px solid #d1d5db;
  background: linear-gradient(180deg,#fff,#f3f4f6);
  cursor: pointer;
  transition: all 0.2s ease;
}
button:hover {
  background: linear-gradient(180deg,#fee2e2,#fecaca);
  border-color: #ef4444;
  color: #7f1d1d;
  transform: translateY(-1px);
}
button.active {
  background: #fee2e2;
  border-color: #ef4444;
  color: #991b1b;
}
button.pg-btn {
  background: linear-gradient(180deg,#f0f9ff,#e0f2fe);
  border-color: #38bdf8;
  color: #0369a1;
}
button.pg-btn:hover {
  background: linear-gradient(180deg,#e0f2fe,#bae6fd);
  border-color: #0ea5e9;
  color: #075985;
}
button.pg-btn.active {
  background: linear-gradient(180deg,#bae6fd,#7dd3fc);
  border-color: #0ea5e9;
  color: #0c4a6e;
}
button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}
.hidden { display: none; }
.note {
  font-size: 12px;
  color: #6b7280;
  margin-top: 4px;
}
.status-indicator {
  padding: 8px 12px;
  border-radius: 8px;
  background: #f0fdf4;
  border: 1px solid #bbf7d0;
  color: #166534;
  font-size: 12px;
  margin-top: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
}
.status-indicator::before {
  content: "â„¹ï¸";
}
.loading {
  background: #eff6ff;
  border-color: #93c5fd;
  color: #1e40af;
}
.loading::before {
  content: "â³";
}
.special-btn {
  background: linear-gradient(180deg,#fef3c7,#fde68a);
  border-color: #f59e0b;
  color: #92400e;
}
.special-btn:hover {
  background: linear-gradient(180deg,#fde68a,#fcd34d);
  border-color: #f59e0b;
  color: #92400e;
}
.identity-btn {
  background: linear-gradient(180deg,#d1fae5,#a7f3d0);
  border-color: #10b981;
  color: #065f46;
}
.identity-btn:hover {
  background: linear-gradient(180deg,#a7f3d0,#6ee7b7);
  border-color: #10b981;
  color: #065f46;
}
.inversion-btn {
  background: linear-gradient(180deg,#e0e7ff,#c7d2fe);
  border-color: #6366f1;
  color: #3730a3;
}
.inversion-btn:hover {
  background: linear-gradient(180deg,#c7d2fe,#a5b4fc);
  border-color: #6366f1;
  color: #3730a3;
}
.chcl3-btn {
  background: linear-gradient(180deg,#f3e8ff,#e9d5ff);
  border-color: #a855f7;
  color: #6b21a8;
}
.chcl3-btn:hover {
  background: linear-gradient(180deg,#e9d5ff,#d8b4fe);
  border-color: #a855f7;
  color: #6b21a8;
}
.molecule-buttons-container {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-top: 8px;
}
</style>
</head>
<body>
<div class="header">
  åˆ†å­ç‚¹ç¾¤ä¸å¯¹ç§°æ“ä½œäº¤äº’æ¼”ç¤ºï¼ˆæ‰€æœ‰åŠ¨ç”»å‡æ”¯æŒè§†è§’ä¿æŒï¼‰
</div>
<div class="main">
  <div class="viewer-panel">
    <div id="viewer"></div>
    <div id="pgInfo" class="pg-info">
      <div class="pg-title">ç‚¹ç¾¤è¯´æ˜</div>
      <div class="pg-text">
        è¯·é€‰æ‹©ä¸€ä¸ªåˆ†å­ä»¥æŸ¥çœ‹å…¶ç‚¹ç¾¤ä¸å¯¹ç§°å…ƒç´ è¯´æ˜ã€‚
      </div>
    </div>
  </div>

  <div class="control-panel">
    <div class="section">
      <div class="section-title">é€‰æ‹©ç‚¹ç¾¤ç±»å‹</div>
      <button class="pg-btn active" onclick="selectPointGroup('all')">å…¨éƒ¨åˆ†å­</button>
      <button class="pg-btn" onclick="selectPointGroup('C2v')">Câ‚‚áµ¥ ç‚¹ç¾¤</button>
      <button class="pg-btn" onclick="selectPointGroup('C3v')">Câ‚ƒáµ¥ ç‚¹ç¾¤</button>
      <button class="pg-btn" onclick="selectPointGroup('C2')">Câ‚‚ ç‚¹ç¾¤</button>
      <button class="pg-btn" onclick="selectPointGroup('C2h')">Câ‚‚Ê° ç‚¹ç¾¤</button>
      <button class="pg-btn" onclick="selectPointGroup('Dâˆh')">DâˆÊ° ç‚¹ç¾¤</button>
      <button class="pg-btn" onclick="selectPointGroup('D3h')">Dâ‚ƒÊ° ç‚¹ç¾¤</button>
      <button class="pg-btn" onclick="selectPointGroup('D6h')">Dâ‚†Ê° ç‚¹ç¾¤</button>
      <button class="pg-btn" onclick="selectPointGroup('D2h')">Dâ‚‚Ê° ç‚¹ç¾¤</button>
      <button class="pg-btn" onclick="selectPointGroup('D4h')">Dâ‚„Ê° ç‚¹ç¾¤</button>
      <div class="status-indicator" id="pg-status">å½“å‰æ˜¾ç¤º: å…¨éƒ¨åˆ†å­</div>
    </div>

    <div class="section">
      <div class="section-title">é€‰æ‹©åˆ†å­</div>
      <div id="molecule-buttons-container" class="molecule-buttons-container">
        <!-- åˆ†å­æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
      </div>
      <div class="status-indicator" id="mol-status">å·²åŠ è½½: Hâ‚‚O (æ°´åˆ†å­)</div>
    </div>

    <div class="section" id="h2oSpecialSection">
      <div class="section-title">Hâ‚‚O ç‰¹æ®ŠåŠ¨ç”»ï¼ˆæ”¯æŒè§†è§’ä¿æŒï¼‰</div>
      <button id="btnSigmaV" class="special-btn" onclick="playSigmaVxz()">æ’­æ”¾ Ïƒáµ¥(xz) è¿ç»­åå°„</button>
      <button id="btnSigmaPrimeV" class="identity-btn" onclick="playSigmaPrimeVyz()">æ’­æ”¾ Ïƒáµ¥â€²(yz) åå°„</button>
      <div class="note">å…ˆç”¨é¼ æ ‡æ—‹è½¬åˆ°æƒ³è¦çš„è§’åº¦ï¼Œå†ç‚¹å‡»æŒ‰é’®è¿›è¡Œåå°„åŠ¨ç”»</div>
    </div>

    <div class="section" id="c2h2cl2SpecialSection">
      <div class="section-title">Câ‚‚Hâ‚‚Clâ‚‚ åæ¼”å¯¹ç§°åŠ¨ç”»ï¼ˆæ”¯æŒè§†è§’ä¿æŒï¼‰</div>
      <button id="btnC2H2Cl2Inversion" class="inversion-btn" onclick="playC2H2Cl2Inversion()">æ’­æ”¾åæ¼”æ“ä½œ i</button>
      <div class="note">å…ˆç”¨é¼ æ ‡æ—‹è½¬åˆ°æƒ³è¦çš„è§’åº¦ï¼Œå†ç‚¹å‡»æŒ‰é’®è¿›è¡Œåæ¼”åŠ¨ç”»</div>
    </div>

    <div class="section" id="chcl3SpecialSection">
      <div class="section-title">CHClâ‚ƒ Ïƒáµ¥ åå°„åŠ¨ç”»ï¼ˆæ”¯æŒè§†è§’ä¿æŒï¼‰</div>
      <button id="btnSigmaV12" class="chcl3-btn" onclick="playCHCl3SigmaV12()">Ïƒáµ¥â‚ï¼ˆCl1 â†” Cl2ï¼‰</button>
      <button id="btnSigmaV23" class="chcl3-btn" onclick="playCHCl3SigmaV23()">Ïƒáµ¥â‚‚ï¼ˆCl2 â†” Cl3ï¼‰</button>
      <button id="btnSigmaV31" class="chcl3-btn" onclick="playCHCl3SigmaV31()">Ïƒáµ¥â‚ƒï¼ˆCl3 â†” Cl1ï¼‰</button>
      <div class="note">å…ˆç”¨é¼ æ ‡æ—‹è½¬åˆ°æƒ³è¦çš„è§’åº¦ï¼Œå†ç‚¹å‡»æŒ‰é’®è¿›è¡ŒÏƒáµ¥åå°„</div>
    </div>

    <div class="section" id="co2SpecialSection">
      <div class="section-title">COâ‚‚ ç‰¹æ®ŠåŠ¨ç”»ï¼ˆæ”¯æŒè§†è§’ä¿æŒï¼‰</div>
      <button id="btnInversion" class="special-btn" onclick="playInversion()">æ’­æ”¾åæ¼”æ“ä½œ i</button>
      <div class="note">å…ˆç”¨é¼ æ ‡æ—‹è½¬åˆ°æƒ³è¦çš„è§’åº¦ï¼Œå†ç‚¹å‡»æŒ‰é’®è¿›è¡Œåæ¼”åŠ¨ç”»</div>
    </div>

    <div class="section">
      <div class="section-title">å¯ç”¨ Câ‚™ æ—‹è½¬æ“ä½œ</div>
      <button id="btnC2" class="hidden" onclick="doCnWithReset(2)">Câ‚‚</button>
      <button id="btnC3" class="hidden" onclick="doCnWithReset(3)">Câ‚ƒ</button>
      <button id="btnC4" class="hidden" onclick="doCnWithReset(4)">Câ‚„</button>
      <button id="btnC5" class="hidden" onclick="doCnWithReset(5)">Câ‚…</button>
      <button id="btnC6" class="hidden" onclick="doCnWithReset(6)">Câ‚†</button>
      <div class="status-indicator" id="op-status">å¯ç”¨æ“ä½œ: Câ‚‚</div>
    </div>
    
    <div class="section">
      <div class="section-title">è§†å›¾æ§åˆ¶</div>
      <button onclick="resetView()">é‡ç½®è§†å›¾</button>
      <button onclick="Jmol.script(myJmol, 'spin on;')">è‡ªåŠ¨æ—‹è½¬</button>
      <button onclick="Jmol.script(myJmol, 'spin off;')">åœæ­¢æ—‹è½¬</button>
      <div class="note">é‡ç½®è§†å›¾å¯ä»¥æ¢å¤åˆ†å­çš„åŸå§‹çŠ¶æ€</div>
    </div>
  </div>
</div>

<script>
Jmol.setDocument(0);
// æ›´æ–°Infoå¯¹è±¡çš„å®½åº¦å’Œé«˜åº¦ä¸ºè‡ªé€‚åº”
var Info = {
  width: "100%",
  height: "100%",
  use: "HTML5",
  j2sPath: "jsmol/j2s",
  script: "set antialiasDisplay; set zoomLarge false; background white;"
};
var myJmol = Jmol.getApplet("myJmol", Info);
document.getElementById("viewer").innerHTML = Jmol.getAppletHtml(myJmol);

// åˆ†å­æ•°æ®æ•°ç»„
var molecules = [
  {file: "water.xyz", displayName: "Hâ‚‚O", pointGroup: "C2v", cnList: [2]},
  {file: "C2H2Cl2.mol", displayName: "Câ‚‚Hâ‚‚Clâ‚‚", pointGroup: "C2v", cnList: [2]},
  {file: "h2o2.mol", displayName: "Hâ‚‚Oâ‚‚", pointGroup: "C2", cnList: [2]},
  {file: "CHCl3.mol", displayName: "CHClâ‚ƒ", pointGroup: "C3v", cnList: [3]},
  {file: "h3c-ccl3.mol", displayName: "CHâ‚ƒâ€“CClâ‚ƒ", pointGroup: "C3v", cnList: [3]},
  {file: "ClHC=C=CHCl.mol", displayName: "ClHC=C=CHCl", pointGroup: "C2h", cnList: [2]},
  {file: "CO2.mol", displayName: "COâ‚‚", pointGroup: "Dâˆh", cnList: [2]},
  {file: "BF3.mol", displayName: "BFâ‚ƒ", pointGroup: "D3h", cnList: [3]},
  {file: "SbCl5(e2-).mol", displayName: "SbClâ‚…Â²â»", pointGroup: "D3h", cnList: [5]},
  {file: "C6H6.mol", displayName: "Câ‚†Hâ‚†", pointGroup: "D6h", cnList: [6,3,2]},
  {file: "H2C=CH2.mol", displayName: "Hâ‚‚C=CHâ‚‚", pointGroup: "D2h", cnList: [2]},
  {file: "H2CCCH2.mol", displayName: "Hâ‚‚CCCHâ‚‚", pointGroup: "D2h", cnList: [2]},
  {file: "PtCl4(e2-).mol", displayName: "PtClâ‚„Â²â»", pointGroup: "D4h", cnList: [4,2]}
];

var pointGroupText = {
  "water.xyz":       { name:"Câ‚‚áµ¥", text:"æ°´åˆ†å­å±äº Câ‚‚áµ¥ ç‚¹ç¾¤ï¼Œå…·æœ‰ä¸€ä¸ª Câ‚‚ ä¸»è½´å’Œä¸¤ä¸ªå‚ç›´é•œé¢ Ïƒáµ¥ã€‚" },
  "h2o2.mol":        { name:"Câ‚‚",  text:"è¿‡æ°§åŒ–æ°¢ä¸ºéå¹³é¢æ„å‹ï¼Œå±äº Câ‚‚ ç‚¹ç¾¤ï¼Œä»…åŒ…å«ä¸€ä¸ª Câ‚‚ æ—‹è½¬è½´ã€‚" },
  "C2H2Cl2.mol":     { name:"Câ‚‚áµ¥", text:"1,2-äºŒæ°¯ä¹™çƒ¯ï¼ˆé¡ºå¼ï¼‰å±äº Câ‚‚áµ¥ ç‚¹ç¾¤ï¼Œå…·æœ‰ Câ‚‚ è½´ä¸ä¸¤ä¸ªé•œé¢ã€‚" },
  "CHCl3.mol":       { name:"Câ‚ƒáµ¥", text:"æ°¯ä»¿å±äº Câ‚ƒáµ¥ ç‚¹ç¾¤ï¼Œå…·æœ‰ä¸€ä¸ª Câ‚ƒ ä¸»è½´å’Œä¸‰ä¸ª Ïƒáµ¥ é•œé¢ã€‚" },
  "ClHC=C=CHCl.mol": { name:"Câ‚‚Ê°", text:"ClHC=C=CHCl ä¸ºå¹³é¢åˆ†å­ï¼Œå…·æœ‰ Câ‚‚ è½´ä¸åæ¼”ä¸­å¿ƒï¼Œå±äº Câ‚‚Ê° ç‚¹ç¾¤ã€‚" },
  "h3c-ccl3.mol":    { name:"Câ‚ƒáµ¥", text:"CHâ‚ƒâ€“CClâ‚ƒ è¿‘ä¼¼å±äº Câ‚ƒáµ¥ ç‚¹ç¾¤ï¼Œå…·æœ‰ä¸€æ¡ Câ‚ƒ ä¸»è½´å’Œ Ïƒáµ¥ é•œé¢ã€‚" },
  "CO2.mol":         { name:"DâˆÊ°", text:"COâ‚‚ ä¸ºçº¿æ€§åˆ†å­ï¼Œå…·æœ‰åæ¼”ä¸­å¿ƒ iã€æ— ç©·å¤šä¸ª Câ‚‚ è½´åŠ Ïƒâ‚•ã€Ïƒáµ¥ã€‚" },
  "BF3.mol":         { name:"Dâ‚ƒÊ°", text:"BFâ‚ƒ ä¸ºå¹³é¢ä¸‰è§’ç»“æ„ï¼Œå±äº Dâ‚ƒÊ° ç‚¹ç¾¤ï¼Œå…·æœ‰ Câ‚ƒ ä¸»è½´ä¸ Ïƒâ‚•ã€‚" },
  "C6H6.mol":        { name:"Dâ‚†Ê°", text:"è‹¯åˆ†å­å±äº Dâ‚†Ê° ç‚¹ç¾¤ï¼Œå…·æœ‰ Câ‚† ä¸»è½´ã€å¤šä¸ª Câ‚‚ è½´ã€Ïƒâ‚•ã€Ïƒáµ¥ åŠåæ¼”ä¸­å¿ƒã€‚" },
  "H2C=CH2.mol":     { name:"Dâ‚‚Ê°", text:"ä¹™çƒ¯ä¸ºå¹³é¢åˆ†å­ï¼Œå…·æœ‰ä¸‰ä¸ªäº’ç›¸å‚ç›´çš„ Câ‚‚ è½´å’Œåæ¼”ä¸­å¿ƒã€‚" },
  "H2CCCH2.mol":     { name:"Dâ‚‚Ê°", text:"ä¸äºŒçƒ¯å¹³é¢æ„å‹å±äº Dâ‚‚Ê° ç‚¹ç¾¤ï¼Œå…·æœ‰ Câ‚‚ è½´ã€Ïƒâ‚• ä¸åæ¼”ä¸­å¿ƒã€‚" },
  "PtCl4(e2-).mol":  { name:"Dâ‚„Ê°", text:"å¹³æ–¹å¹³é¢ PtClâ‚„Â²â» å±äº Dâ‚„Ê° ç‚¹ç¾¤ï¼Œå…·æœ‰ Câ‚„ ä¸»è½´ä¸ Ïƒâ‚•ã€‚" },
  "SbCl5(e2-).mol":  { name:"Dâ‚ƒÊ°", text:"SbClâ‚…Â²â» ä¸ºä¸‰è§’åŒé”¥æ„å‹ï¼Œå±äº Dâ‚ƒÊ° ç‚¹ç¾¤ã€‚" }
};

// COâ‚‚åŸºå‡†æ¨¡å‹
const co2BaseModel = `
load data "model mol"
CO2
  OpenAI

  3  2  0  0  0  0  0  0  0999 V2000
   -1.1970    0.0000    0.0000 O
    1.1970    0.0000    0.0000 O
    0.0000    0.0000    0.0000 C
  1  3  2  0
  2  3  2  0
M  END
end "model mol"

set antialiasDisplay;
set zoomLarge false;
spacefill 22%;
wireframe 0.15;
color oxygen red;
color carbon gray;
label %e;
center;
zoom 120;
`;

// Hâ‚‚OåŸºå‡†æ¨¡å‹
const h2oBaseModel = `
load data "h2o xyz"
3
Hâ‚‚O
O  0.000   0.000   0.000
H  0.000   0.757   0.586
H  0.000  -0.757   0.586
end "h2o xyz"
set zoomlarge false;
set antialiasDisplay;
spacefill 23%;
wireframe 0.15;
color oxygen red;
color hydrogen white;
label %e;
center;
zoom 120;
`;

// Câ‚‚Hâ‚‚Clâ‚‚åŸºå‡†æ¨¡å‹
const c2h2cl2BaseModel = `
load data "model xyz"
6
C2H2Cl2
Cl   2.1437   0.1015  -0.0002
Cl  -2.1439  -0.1011  -0.0002
C    0.5135  -0.4232   0.0002
C   -0.5132   0.4227   0.0002
H    0.4242  -1.5014   0.0001
H   -0.4237   1.5009   0.0001
end "model xyz"

set zoomlarge false;
set antialiasDisplay;
spacefill 23%;
wireframe 0.15;
color chlorine green;
color carbon gray;
color hydrogen white;
label %e;
center;
zoom 120;
`;

// CHClâ‚ƒåŸºå‡†æ¨¡å‹
const chcl3BaseModel = `
load data "model xyz"
5
CHCl3
Cl  -0.0962  -1.6789   0.1394
Cl  -1.4059   0.9228   0.1394
Cl   1.5022   0.7561   0.1393
C   -0.0001   0.0000  -0.4181
H   -0.0001  -0.0001  -1.5111
end "model xyz"

set zoomlarge false;
set antialiasDisplay;
spacefill 23%;
wireframe 0.15;
color chlorine green;
color carbon gray;
color hydrogen white;
center;
zoom 120;
`;

var currentCn = [];
var currentFile = null;
var currentDisplayName = "";
var isAnimating = false;
var currentPointGroup = "all";

// åˆå§‹åŒ–åˆ†å­æŒ‰é’®
function initMoleculeButtons() {
  // é»˜è®¤æ˜¾ç¤ºæ‰€æœ‰åˆ†å­
  updateMoleculeButtons("all");
}

// æ›´æ–°åˆ†å­æŒ‰é’®æ˜¾ç¤º
function updateMoleculeButtons(pointGroup) {
  currentPointGroup = pointGroup;
  const container = document.getElementById("molecule-buttons-container");
  container.innerHTML = "";
  
  // æ›´æ–°ç‚¹ç¾¤æŒ‰é’®çŠ¶æ€
  document.querySelectorAll(".pg-btn").forEach(btn => {
    btn.classList.remove("active");
  });
  document.querySelector(`button[onclick="selectPointGroup('${pointGroup}')"]`).classList.add("active");
  
  // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
  const pgStatus = document.getElementById("pg-status");
  if (pointGroup === "all") {
    pgStatus.textContent = "å½“å‰æ˜¾ç¤º: å…¨éƒ¨åˆ†å­";
  } else {
    pgStatus.textContent = `å½“å‰æ˜¾ç¤º: ${pointGroup} ç‚¹ç¾¤`;
  }
  
  // ç­›é€‰åˆ†å­
  const filteredMolecules = molecules.filter(mol => {
    if (pointGroup === "all") return true;
    return mol.pointGroup === pointGroup;
  });
  
  // åˆ›å»ºåˆ†å­æŒ‰é’®
  filteredMolecules.forEach(mol => {
    const button = document.createElement("button");
    button.textContent = mol.displayName;
    button.onclick = () => selectMol(mol.file, mol.cnList, mol.displayName);
    container.appendChild(button);
  });
  
  // å¦‚æœæ²¡æœ‰åˆ†å­ï¼Œæ˜¾ç¤ºæç¤º
  if (filteredMolecules.length === 0) {
    const noMolecules = document.createElement("div");
    noMolecules.className = "note";
    noMolecules.textContent = "è¯¥ç‚¹ç¾¤ä¸‹æš‚æ— åˆ†å­";
    container.appendChild(noMolecules);
  }
}

// é€‰æ‹©ç‚¹ç¾¤
function selectPointGroup(pointGroup) {
  if (isAnimating) return;
  updateMoleculeButtons(pointGroup);
}

// é€‰æ‹©åˆ†å­
function selectMol(file, cnList, displayName) {
  if (isAnimating) return;
  
  currentFile = file;
  currentCn = cnList;
  currentDisplayName = displayName;
  
  // é‡ç½®åŠ è½½åˆ†å­
  resetAndLoadMol(file, displayName);
}

function resetAndLoadMol(file, displayName) {
  isAnimating = true;
  
  // æ›´æ–°çŠ¶æ€ä¸ºåŠ è½½ä¸­
  const statusEl = document.getElementById('mol-status');
  statusEl.textContent = `æ­£åœ¨åŠ è½½: ${displayName}...`;
  statusEl.classList.add('loading');
  
  Jmol.script(myJmol, `
    load ${file}
    center
    zoom 120
    spin off
    calculate pointgroup
    draw pointgroup
  `);

  updateButtons();
  updatePointGroupInfo(file, displayName || file.split('.')[0]);
  updateSpecialSectionVisibility();
  
  // å»¶è¿Ÿæ›´æ–°çŠ¶æ€ï¼Œç¡®ä¿åŠ è½½å®Œæˆ
  setTimeout(() => {
    statusEl.textContent = `å·²åŠ è½½: ${displayName}`;
    statusEl.classList.remove('loading');
    
    if (currentCn.length > 0) {
      document.getElementById('op-status').textContent = `å¯ç”¨æ“ä½œ: ${currentCn.map(n => 'C' + n).join(', ')}`;
    } else {
      document.getElementById('op-status').textContent = 'æ­¤åˆ†å­æ— å¯ç”¨çš„Câ‚™å¯¹ç§°æ“ä½œ';
    }
    
    isAnimating = false;
  }, 800);
}

function updateButtons() {
  [2,3,4,5,6].forEach(n => {
    const btn = document.getElementById("btnC"+n);
    if (btn) btn.classList.add("hidden");
  });
  currentCn.forEach(n => {
    const btn = document.getElementById("btnC"+n);
    if (btn) btn.classList.remove("hidden");
  });
}

function updatePointGroupInfo(file, name) {
  const t = document.querySelector(".pg-title");
  const c = document.querySelector(".pg-text");
  if (pointGroupText[file]) {
    t.innerHTML = `ç‚¹ç¾¤è¯´æ˜ï¼ˆ${pointGroupText[file].name}ï¼‰`;
    c.innerHTML = pointGroupText[file].text;
  } else {
    t.innerHTML = "ç‚¹ç¾¤è¯´æ˜";
    c.innerHTML = "æš‚æ— è¯¥åˆ†å­çš„ç‚¹ç¾¤è¯´æ˜ã€‚";
  }
}

function updateSpecialSectionVisibility() {
  const h2oSection = document.getElementById("h2oSpecialSection");
  const c2h2cl2Section = document.getElementById("c2h2cl2SpecialSection");
  const chcl3Section = document.getElementById("chcl3SpecialSection");
  const co2Section = document.getElementById("co2SpecialSection");
  
  // é‡ç½®æ‰€æœ‰éƒ¨åˆ†ä¸ºéšè—
  h2oSection.classList.add("hidden");
  c2h2cl2Section.classList.add("hidden");
  chcl3Section.classList.add("hidden");
  co2Section.classList.add("hidden");
  
  // æ ¹æ®å½“å‰åˆ†å­æ˜¾ç¤ºç›¸åº”çš„éƒ¨åˆ†
  if (currentFile === 'water.xyz') {
    h2oSection.classList.remove("hidden");
  } else if (currentFile === 'C2H2Cl2.mol') {
    c2h2cl2Section.classList.remove("hidden");
  } else if (currentFile === 'CHCl3.mol') {
    chcl3Section.classList.remove("hidden");
  } else if (currentFile === 'CO2.mol') {
    co2Section.classList.remove("hidden");
  }
}

// é€šç”¨å‡½æ•°ï¼šä¿å­˜å½“å‰è§†è§’å¹¶é‡ç½®æ¨¡å‹
function saveViewAndReset(baseModel) {
  // ä¿å­˜å½“å‰è§†è§’
  Jmol.script(myJmol, "save orientation myView;");
  // é‡ç½®æ¨¡å‹ä½†ç«‹å³æ¢å¤è§†è§’
  Jmol.script(myJmol, baseModel + "restore orientation myView;");
}

// Cnæ—‹è½¬å‡½æ•°ï¼šå…ˆé‡ç½®è§†å›¾å†æ—‹è½¬
function doCnWithReset(n) {
  if (isAnimating) return;

  isAnimating = true;

  const opStatus = document.getElementById('op-status');
  opStatus.textContent = `æ­£åœ¨å‡†å¤‡ C${n} æ—‹è½¬...`;
  opStatus.classList.add('loading');

  // âœ…ã€æ–°å¢ã€‘ä¿å­˜å½“å‰ç”¨æˆ·è§†è§’
  Jmol.script(myJmol, "save orientation userView;");

  Jmol.script(myJmol, `
    load ${currentFile}
    center
    zoom 120
    spin off
    calculate pointgroup
    draw pointgroup

    // âœ…ã€æ–°å¢ã€‘ç«‹åˆ»æ¢å¤åˆšæ‰çš„è§†è§’
    restore orientation userView;
  `);

  setTimeout(() => {
    const angle = 360 / n;

    // ğŸ”µ è¿™ä¸€è¡Œå®Œå…¨ä¸åŠ¨ï¼ˆä½ åŸæ¥å°±æ˜¯å¯¹çš„ï¼‰
    Jmol.script(myJmol, `spin $pgva_0_c${n}_1 ${angle} 60`);

    opStatus.textContent = `æ­£åœ¨æ‰§è¡Œ C${n} æ—‹è½¬ï¼Œè§’åº¦: ${angle}Â°`;

    setTimeout(() => {
      isAnimating = false;
      opStatus.classList.remove('loading');
      opStatus.textContent =
        `å¯ç”¨æ“ä½œ: ${currentCn.map(n => 'C' + n).join(', ')}`;
    }, 2000);

  }, 400);
}


// Hâ‚‚Oçš„Ïƒáµ¥(xz)åå°„åŠ¨ç”»ï¼ˆå¸¦è§†è§’ä¿æŒï¼‰
function playSigmaVxz() {
  if (currentFile !== 'water.xyz' || isAnimating) return;

  isAnimating = true;
  const btn = document.getElementById("btnSigmaV");
  btn.disabled = true;
  btn.classList.add("active");
  btn.textContent = "åŠ¨ç”»æ’­æ”¾ä¸­...";
  
  document.getElementById('op-status').textContent = "æ­£åœ¨æ’­æ”¾ Ïƒáµ¥(xz) åå°„åŠ¨ç”»...";
  document.getElementById('op-status').classList.add('loading');

  // ä¿å­˜å½“å‰è§†è§’å¹¶é‡ç½®æ¨¡å‹
  saveViewAndReset(h2oBaseModel);
  
  let script = "set echo off; delay 0.4;";

  const steps = 36;
  const totalAnimationSeconds = 2.0;
  const delayPerStep = totalAnimationSeconds / steps;
  const y0 = 0.757;
  const dy = (-2 * y0) / steps;

  for (let i = 0; i < steps; i++) {
    script += `
      select atomno=2; translateSelected {0 ${dy.toFixed(6)} 0};
      select atomno=3; translateSelected {0 ${(-dy).toFixed(6)} 0};
      delay ${delayPerStep.toFixed(3)};
    `;
  }

  // åŠ¨ç”»å®Œæˆåï¼Œé‡æ–°è®¡ç®—ç‚¹ç¾¤å¹¶é‡æ–°ç»˜åˆ¶
  script += `
    delay 0.5;
    calculate pointgroup;
    draw pointgroup;
    spin off;
    background echo "Ïƒáµ¥(xz) åå°„åŠ¨ç”»å®Œæˆ";
    delay 0.8;
    background echo OFF;
  `;

  Jmol.script(myJmol, script);

  setTimeout(() => {
    isAnimating = false;
    btn.disabled = false;
    btn.classList.remove("active");
    btn.textContent = "æ’­æ”¾ Ïƒáµ¥(xz) è¿ç»­åå°„";
    
    // æ›´æ–°çŠ¶æ€
    document.getElementById('op-status').classList.remove('loading');
    document.getElementById('op-status').textContent = "Ïƒáµ¥(xz) åŠ¨ç”»å®Œæˆï¼ŒCâ‚‚ æ“ä½œå·²æ¢å¤";
    
    // å»¶è¿Ÿåæ¢å¤çŠ¶æ€æ˜¾ç¤º
    setTimeout(() => {
      document.getElementById('op-status').textContent = "å¯ç”¨æ“ä½œ: Câ‚‚";
    }, 1500);
  }, (totalAnimationSeconds + 1.8) * 1000);
}

// Hâ‚‚Oçš„Ïƒáµ¥â€²(yz)åå°„æ“ä½œ - æ’ç­‰æ“ä½œï¼ˆå¸¦è§†è§’ä¿æŒï¼‰
function playSigmaPrimeVyz() {
  if (currentFile !== 'water.xyz' || isAnimating) return;
  
  isAnimating = true;
  const btn = document.getElementById("btnSigmaPrimeV");
  btn.disabled = true;
  btn.classList.add("active");
  btn.textContent = "æ‰§è¡Œæ’ç­‰æ“ä½œ...";
  
  document.getElementById('op-status').textContent = "æ­£åœ¨æ‰§è¡Œ Ïƒáµ¥â€²(yz) åå°„æ“ä½œ...";
  document.getElementById('op-status').classList.add('loading');

  // ä¿å­˜å½“å‰è§†è§’å¹¶é‡ç½®æ¨¡å‹
  saveViewAndReset(h2oBaseModel);
  
  // çŸ­æš‚å»¶è¿Ÿåæ˜¾ç¤ºé†’ç›®çš„æç¤ºä¿¡æ¯
  setTimeout(() => {
    // æ˜¾ç¤ºé†’ç›®çš„å¤§å­—æç¤º
    Jmol.script(myJmol, `
      background echo "<font size='+4' color='#dc2626'><b>Ïƒáµ¥â€²(yz) å¹³é¢åå°„</b></font>";
      delay 1.0;
      background echo "<font size='+3' color='#dc2626'><b>è¯¥å¹³é¢æ˜¯æ°´åˆ†å­çš„åˆ†å­å¹³é¢</b></font>";
      delay 1.0;
      background echo "<font size='+3' color='#dc2626'><b>æ‰€æœ‰åŸå­éƒ½ä½äº yz å¹³é¢å†…</b></font>";
      delay 1.2;
      background echo "<font size='+4' color='#059669'><b>é‡è¦ç»“è®ºï¼š</b></font>";
      delay 0.8;
      background echo "<font size='+4' color='#059669'><b>æ‰€æœ‰åŸå­éƒ½æ˜ å°„å›è‡ªèº«</b></font>";
      delay 0.8;
      background echo "<font size='+4' color='#059669'><b>å› æ­¤åˆ†å­ç»“æ„å®Œå…¨ä¸å˜</b></font>";
      delay 2.0;
      background echo OFF;
    `);
    
    // åŒæ—¶åœ¨çŠ¶æ€æ æ˜¾ç¤ºé‡è¦ä¿¡æ¯
    document.getElementById('op-status').classList.remove('loading');
    document.getElementById('op-status').innerHTML = `
      <strong style="color:#dc2626;font-size:14px;">Ïƒáµ¥â€²(yz) åå°„ï¼šæ’ç­‰æ“ä½œ</strong>
      <br>
      <span style="color:#059669;">æ‰€æœ‰åŸå­æ˜ å°„å›è‡ªèº« â†’ åˆ†å­ç»“æ„ä¸å˜</span>
    `;
    
    // æ¢å¤æŒ‰é’®çŠ¶æ€
    setTimeout(() => {
      isAnimating = false;
      btn.disabled = false;
      btn.classList.remove("active");
      btn.textContent = "æ’­æ”¾ Ïƒáµ¥â€²(yz) åå°„";
      
      // å»¶è¿Ÿåæ¢å¤çŠ¶æ€æ˜¾ç¤º
      setTimeout(() => {
        document.getElementById('op-status').textContent = "å¯ç”¨æ“ä½œ: Câ‚‚";
      }, 3000);
    }, 7000);
  }, 500);
}

// Câ‚‚Hâ‚‚Clâ‚‚çš„åæ¼”æ“ä½œiåŠ¨ç”»ï¼ˆå¸¦è§†è§’ä¿æŒï¼‰
function playC2H2Cl2Inversion() {
  if (currentFile !== 'C2H2Cl2.mol' || isAnimating) return;

  isAnimating = true;
  const btn = document.getElementById("btnC2H2Cl2Inversion");
  btn.disabled = true;
  btn.classList.add("active");
  btn.textContent = "åŠ¨ç”»æ’­æ”¾ä¸­...";
  
  document.getElementById('op-status').textContent = "æ­£åœ¨æ’­æ”¾ Câ‚‚Hâ‚‚Clâ‚‚ åæ¼”æ“ä½œ i...";
  document.getElementById('op-status').classList.add('loading');

  // ä¿å­˜å½“å‰è§†è§’å¹¶é‡ç½®æ¨¡å‹
  saveViewAndReset(c2h2cl2BaseModel);
  
  // åŸå­æ•°æ®
  const atoms = [
    {id:1, x: 2.1437,  y: 0.1015,  z:-0.0002},
    {id:2, x:-2.1439,  y:-0.1011, z:-0.0002},
    {id:3, x: 0.5135,  y:-0.4232, z: 0.0002},
    {id:4, x:-0.5132,  y: 0.4227, z: 0.0002},
    {id:5, x: 0.4242,  y:-1.5014, z: 0.0001},
    {id:6, x:-0.4237,  y: 1.5009, z: 0.0001}
  ];

  const steps = 50;
  let script = "set echo off; delay 0.4;";
  
  // æ„å»ºåŠ¨ç”»è„šæœ¬ï¼ˆé€æ­¥ç§»åŠ¨æ¯ä¸ªåŸå­åˆ°å…¶åæ¼”ä½ç½®ï¼‰
  for (let i = 0; i < steps; i++) {
    atoms.forEach(a => {
      script +=
        "select atomno=" + a.id + ";" +
        "translateSelected {" +
        (-2*a.x/steps).toFixed(4) + " " +
        (-2*a.y/steps).toFixed(4) + " " +
        (-2*a.z/steps).toFixed(4) +
        "};";
    });
    script += "delay 0.04;";
  }
  
  // åŠ¨ç”»å®Œæˆåï¼Œé‡æ–°è®¡ç®—ç‚¹ç¾¤
  script += `
    delay 0.5;
    calculate pointgroup;
    draw pointgroup;
    spin off;
    background echo "Câ‚‚Hâ‚‚Clâ‚‚ åæ¼”æ“ä½œ i åŠ¨ç”»å®Œæˆ";
    delay 0.8;
    background echo OFF;
  `;

  Jmol.script(myJmol, script);

  setTimeout(() => {
    isAnimating = false;
    btn.disabled = false;
    btn.classList.remove("active");
    btn.textContent = "æ’­æ”¾åæ¼”æ“ä½œ i";
    
    // æ›´æ–°çŠ¶æ€
    document.getElementById('op-status').classList.remove('loading');
    document.getElementById('op-status').textContent = "Câ‚‚Hâ‚‚Clâ‚‚ åæ¼”æ“ä½œ i åŠ¨ç”»å®Œæˆ";
    
    // å»¶è¿Ÿåæ¢å¤çŠ¶æ€æ˜¾ç¤º
    setTimeout(() => {
      document.getElementById('op-status').textContent = "å¯ç”¨æ“ä½œ: Câ‚‚";
    }, 1500);
  }, (steps * 0.04 + 1.8) * 1000);
}

// CHClâ‚ƒ Ïƒáµ¥åå°„åŠ¨ç”» - é€šç”¨äº¤æ¢å‡½æ•°ï¼ˆä¿æŒè§†è§’ï¼‰
function swapClKeepView(idA, idB, atomA, atomB) {
  // ä¿å­˜å½“å‰è§†è§’å¹¶é‡ç½®æ¨¡å‹
  saveViewAndReset(chcl3BaseModel);
  
  const steps = 40;
  const dxA = (atomB.x - atomA.x) / steps;
  const dyA = (atomB.y - atomA.y) / steps;
  const dzA = (atomB.z - atomA.z) / steps;
  
  const dxB = (atomA.x - atomB.x) / steps;
  const dyB = (atomA.y - atomB.y) / steps;
  const dzB = (atomA.z - atomB.z) / steps;
  
  let script = "set echo off;";
  
  for (let i = 0; i < steps; i++) {
    script +=
      "select atomno=" + idA + ";" +
      "translateSelected {" +
      dxA.toFixed(4) + " " +
      dyA.toFixed(4) + " " +
      dzA.toFixed(4) + "};" +
      
      "select atomno=" + idB + ";" +
      "translateSelected {" +
      dxB.toFixed(4) + " " +
      dyB.toFixed(4) + " " +
      dzB.toFixed(4) + "};" +
      
      "delay 0.04;";
  }
  
  // åŠ¨ç”»å®Œæˆåé‡æ–°è®¡ç®—ç‚¹ç¾¤
  script += `
    delay 0.5;
    calculate pointgroup;
    draw pointgroup;
    spin off;
    background echo "CHClâ‚ƒ Ïƒáµ¥ åå°„åŠ¨ç”»å®Œæˆ";
    delay 0.8;
    background echo OFF;
  `;
  
  Jmol.script(myJmol, script);
}

// CHClâ‚ƒ Ïƒáµ¥â‚åå°„ï¼šCl1 â†” Cl2ï¼ˆå¸¦è§†è§’ä¿æŒï¼‰
function playCHCl3SigmaV12() {
  if (currentFile !== 'CHCl3.mol' || isAnimating) return;
  
  isAnimating = true;
  const btn = document.getElementById("btnSigmaV12");
  btn.disabled = true;
  btn.classList.add("active");
  btn.textContent = "åŠ¨ç”»æ’­æ”¾ä¸­...";
  
  document.getElementById('op-status').textContent = "æ­£åœ¨æ’­æ”¾ CHClâ‚ƒ Ïƒáµ¥â‚ åå°„åŠ¨ç”»...";
  document.getElementById('op-status').classList.add('loading');
  
  // ç›´æ¥è°ƒç”¨äº¤æ¢å‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨ä¼šå¤„ç†è§†è§’ä¿æŒ
  swapClKeepView(
    1, 2,
    {x:-0.0962, y:-1.6789, z:0.1394},
    {x:-1.4059, y:0.9228, z:0.1394}
  );
  
  // åŠ¨ç”»æ€»æ—¶é—´ï¼š40æ­¥ Ã— 0.04ç§’ + 0.5ç§’ + 0.8ç§’ = 2.9ç§’
  setTimeout(() => {
    isAnimating = false;
    btn.disabled = false;
    btn.classList.remove("active");
    btn.textContent = "Ïƒáµ¥â‚ï¼ˆCl1 â†” Cl2ï¼‰";
    
    // æ›´æ–°çŠ¶æ€
    document.getElementById('op-status').classList.remove('loading');
    document.getElementById('op-status').textContent = "CHClâ‚ƒ Ïƒáµ¥â‚ åå°„åŠ¨ç”»å®Œæˆ";
    
    // å»¶è¿Ÿåæ¢å¤çŠ¶æ€æ˜¾ç¤º
    setTimeout(() => {
      document.getElementById('op-status').textContent = "å¯ç”¨æ“ä½œ: Câ‚ƒ";
    }, 1500);
  }, 3500);
}

// CHClâ‚ƒ Ïƒáµ¥â‚‚åå°„ï¼šCl2 â†” Cl3ï¼ˆå¸¦è§†è§’ä¿æŒï¼‰
function playCHCl3SigmaV23() {
  if (currentFile !== 'CHCl3.mol' || isAnimating) return;
  
  isAnimating = true;
  const btn = document.getElementById("btnSigmaV23");
  btn.disabled = true;
  btn.classList.add("active");
  btn.textContent = "åŠ¨ç”»æ’­æ”¾ä¸­...";
  
  document.getElementById('op-status').textContent = "æ­£åœ¨æ’­æ”¾ CHClâ‚ƒ Ïƒáµ¥â‚‚ åå°„åŠ¨ç”»...";
  document.getElementById('op-status').classList.add('loading');
  
  // ç›´æ¥è°ƒç”¨äº¤æ¢å‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨ä¼šå¤„ç†è§†è§’ä¿æŒ
  swapClKeepView(
    2, 3,
    {x:-1.4059, y:0.9228, z:0.1394},
    {x:1.5022, y:0.7561, z:0.1393}
  );
  
  setTimeout(() => {
    isAnimating = false;
    btn.disabled = false;
    btn.classList.remove("active");
    btn.textContent = "Ïƒáµ¥â‚‚ï¼ˆCl2 â†” Cl3ï¼‰";
    
    // æ›´æ–°çŠ¶æ€
    document.getElementById('op-status').classList.remove('loading');
    document.getElementById('op-status').textContent = "CHClâ‚ƒ Ïƒáµ¥â‚‚ åå°„åŠ¨ç”»å®Œæˆ";
    
    // å»¶è¿Ÿåæ¢å¤çŠ¶æ€æ˜¾ç¤º
    setTimeout(() => {
      document.getElementById('op-status').textContent = "å¯ç”¨æ“ä½œ: Câ‚ƒ";
    }, 1500);
  }, 3500);
}

// CHClâ‚ƒ Ïƒáµ¥â‚ƒåå°„ï¼šCl3 â†” Cl1ï¼ˆå¸¦è§†è§’ä¿æŒï¼‰
function playCHCl3SigmaV31() {
  if (currentFile !== 'CHCl3.mol' || isAnimating) return;
  
  isAnimating = true;
  const btn = document.getElementById("btnSigmaV31");
  btn.disabled = true;
  btn.classList.add("active");
  btn.textContent = "åŠ¨ç”»æ’­æ”¾ä¸­...";
  
  document.getElementById('op-status').textContent = "æ­£åœ¨æ’­æ”¾ CHClâ‚ƒ Ïƒáµ¥â‚ƒ åå°„åŠ¨ç”»...";
  document.getElementById('op-status').classList.add('loading');
  
  // ç›´æ¥è°ƒç”¨äº¤æ¢å‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨ä¼šå¤„ç†è§†è§’ä¿æŒ
  swapClKeepView(
    3, 1,
    {x:1.5022, y:0.7561, z:0.1393},
    {x:-0.0962, y:-1.6789, z:0.1394}
  );
  
  setTimeout(() => {
    isAnimating = false;
    btn.disabled = false;
    btn.classList.remove("active");
    btn.textContent = "Ïƒáµ¥â‚ƒï¼ˆCl3 â†” Cl1ï¼‰";
    
    // æ›´æ–°çŠ¶æ€
    document.getElementById('op-status').classList.remove('loading');
    document.getElementById('op-status').textContent = "CHClâ‚ƒ Ïƒáµ¥â‚ƒ åå°„åŠ¨ç”»å®Œæˆ";
    
    // å»¶è¿Ÿåæ¢å¤çŠ¶æ€æ˜¾ç¤º
    setTimeout(() => {
      document.getElementById('op-status').textContent = "å¯ç”¨æ“ä½œ: Câ‚ƒ";
    }, 1500);
  }, 3500);
}

// COâ‚‚çš„åæ¼”æ“ä½œiåŠ¨ç”»ï¼ˆå¸¦è§†è§’ä¿æŒï¼‰
function playInversion() {
  if (currentFile !== 'CO2.mol' || isAnimating) return;

  isAnimating = true;
  const btn = document.getElementById("btnInversion");
  btn.disabled = true;
  btn.classList.add("active");
  btn.textContent = "åŠ¨ç”»æ’­æ”¾ä¸­...";
  
  document.getElementById('op-status').textContent = "æ­£åœ¨æ’­æ”¾åæ¼”æ“ä½œ i åŠ¨ç”»...";
  document.getElementById('op-status').classList.add('loading');

  // ä¿å­˜å½“å‰è§†è§’å¹¶é‡ç½®æ¨¡å‹
  saveViewAndReset(co2BaseModel);
  
  let script = "set echo off; delay 0.4;";

  const steps = 36;
  const totalAnimationSeconds = 2.0;
  const delayPerStep = totalAnimationSeconds / steps;
  const x0 = 1.197;  // COâ‚‚ä¸­æ°§åŸå­çš„xåæ ‡
  const dx = (-2 * x0) / steps;  // æ¯ä¸ªæ­¥é•¿ç§»åŠ¨çš„è·ç¦»

  // ä¸¤ä¸ªæ°§åŸå­é€šè¿‡ç¢³åŸå­ï¼ˆåŸç‚¹ï¼‰åæ¼”äº¤æ¢ä½ç½®
  for (let i = 0; i < steps; i++) {
    script += `
      select atomno=1;
      translateSelected {${(-dx).toFixed(6)} 0 0};
      select atomno=2;
      translateSelected {${dx.toFixed(6)} 0 0};
      delay ${delayPerStep.toFixed(3)};
    `;
  }

  // åŠ¨ç”»å®Œæˆåï¼Œé‡æ–°è®¡ç®—ç‚¹ç¾¤å¹¶é‡æ–°ç»˜åˆ¶
  script += `
    delay 0.5;
    calculate pointgroup;
    draw pointgroup;
    spin off;
    background echo "åæ¼”æ“ä½œ i åŠ¨ç”»å®Œæˆ";
    delay 0.8;
    background echo OFF;
  `;

  Jmol.script(myJmol, script);

  setTimeout(() => {
    isAnimating = false;
    btn.disabled = false;
    btn.classList.remove("active");
    btn.textContent = "æ’­æ”¾åæ¼”æ“ä½œ i";
    
    // æ›´æ–°çŠ¶æ€
    document.getElementById('op-status').classList.remove('loading');
    document.getElementById('op-status').textContent = "åæ¼”æ“ä½œ i åŠ¨ç”»å®Œæˆï¼ŒCâ‚‚ æ“ä½œå·²æ¢å¤";
    
    // å»¶è¿Ÿåæ¢å¤çŠ¶æ€æ˜¾ç¤º
    setTimeout(() => {
      document.getElementById('op-status').textContent = "å¯ç”¨æ“ä½œ: Câ‚‚";
    }, 1500);
  }, (totalAnimationSeconds + 1.8) * 1000);
}

// é‡ç½®è§†å›¾å‡½æ•°
function resetView() {
  if (isAnimating || !currentFile) return;
  
  // é‡ç½®åŠ è½½å½“å‰åˆ†å­
  resetAndLoadMol(currentFile, currentDisplayName);
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
window.onload = function() {
  // åˆå§‹åŒ–åˆ†å­æŒ‰é’®
  initMoleculeButtons();
  
  // åˆå§‹åŠ è½½æ°´åˆ†å­
  setTimeout(() => {
    selectMol('water.xyz', [2], 'Hâ‚‚O');
  }, 300);
};

// çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è°ƒæ•´JSmolå¤§å°
window.addEventListener('resize', function() {
  // JSmolä¼šè‡ªåŠ¨é€‚åº”å®¹å™¨å¤§å°ï¼Œä½†æˆ‘ä»¬å¯ä»¥å¼ºåˆ¶åˆ·æ–°ä¸€ä¸‹
  Jmol.script(myJmol, 'refresh');
});
</script>
</body>
</html>
